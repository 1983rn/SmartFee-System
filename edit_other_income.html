{% extends "base.html" %}

{% block title %}Edit Other Income - SmartFee System{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-edit me-2"></i>Edit Other Income</h2>
    <a href="{{ url_for('income') }}" class="btn btn-secondary">
        <i class="fas fa-arrow-left me-2"></i>Back to Income
    </a>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h5>Edit Other Income Record</h5>
            </div>
            <div class="card-body">
                <form method="POST">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="date" class="form-label">Date *</label>
                                <input type="date" class="form-control" id="date" name="date" 
                                       value="{{ other_income.date.strftime('%Y-%m-%d') }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="customer_name" class="form-label">Customer Name *</label>
                                <input type="text" class="form-control" id="customer_name" name="customer_name" 
                                       value="{{ other_income.customer_name }}" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="income_type" class="form-label">Type of Income *</label>
                        <select class="form-select" id="income_type" name="income_type" required>
                            <option value="">Select Income Type</option>
                            {% for type in income_types %}
                            <option value="{{ type }}" {% if type == other_income.income_type %}selected{% endif %}>{{ type }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="total_charge" class="form-label">Total Charge (MK) *</label>
                                <input type="number" step="0.01" class="form-control" id="total_charge" 
                                       name="total_charge" value="{{ other_income.total_charge }}" required min="0.01" 
                                       onchange="calculateBalance()">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="amount_paid" class="form-label">Amount Paid (MK) *</label>
                                <input type="number" step="0.01" class="form-control" id="amount_paid" 
                                       name="amount_paid" value="{{ other_income.amount_paid }}" required min="0" 
                                       onchange="calculateBalance()">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="balance" class="form-label">Balance (MK)</label>
                                <input type="number" step="0.01" class="form-control" id="balance" 
                                       value="{{ other_income.balance }}" readonly>
                            </div>
                        </div>
                    </div>
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" class="btn btn-secondary me-md-2" onclick="history.back()">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-success">
                            <i class="fas fa-save me-2"></i>Update Record
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function calculateBalance() {
    const totalCharge = parseFloat(document.getElementById('total_charge').value) || 0;
    const amountPaid = parseFloat(document.getElementById('amount_paid').value) || 0;
    const balance = totalCharge - amountPaid;
    document.getElementById('balance').value = balance.toFixed(2);
}
</script>
{% endblock %}